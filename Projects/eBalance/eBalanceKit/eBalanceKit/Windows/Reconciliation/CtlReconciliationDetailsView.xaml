<UserControl x:Class="eBalanceKit.Windows.Reconciliation.CtlReconciliationDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:Localisation="clr-namespace:eBalanceKitResources.Localisation;assembly=eBalanceKitResources"
             xmlns:wpfc="clr-namespace:AvdWpfControls;assembly=AvdWpfControls"
             xmlns:Reconciliation="clr-namespace:eBalanceKit.Windows.Reconciliation"
             xmlns:Enums="clr-namespace:eBalanceKitBusiness.Reconciliation.Enums;assembly=eBalanceKitBusiness"
             xmlns:DragDropHelperItems="clr-namespace:eBalanceKit.Windows.Reconciliation.DragDropHelperItems"
             xmlns:my="clr-namespace:eBalanceKit.Controls" mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300" AllowDrop="True" DragOver="ControlDragOver">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Windows\Reconciliation\ReconciliationResources.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
        <Grid>
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Visibility" Value="Collapsed" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>PreviousYearValues</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>ImportedValues</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>
                    
                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>Reclassification</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>ValueChange</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>Delta</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>AuditCorrection</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>AuditCorrectionPreviousYear</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>

                    <DataTrigger Binding="{Binding ReconciliationType}">
                        <DataTrigger.Value>
                            <Enums:ReconciliationTypes>TaxBalanceValue</Enums:ReconciliationTypes>
                        </DataTrigger.Value>
                        <Setter Property="Visibility" Value="Visible" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

            <Border Grid.Row="0" Style="{StaticResource ButtonBorder}">
            <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.ReconciliationTransaction}" Margin="5,2" />
            </Border>
            
        <!--<GridSplitter Grid.Row="0" VerticalAlignment="Bottom" HorizontalAlignment="Stretch" Style="{StaticResource HorizontalGridSplitter}" />-->
            <Grid Grid.Row="1">
                <Border Style="{StaticResource GroupBoxBorder}" Padding="5,2,5,5" CornerRadius="0">
                <Grid>
                    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="stackPanel" Visibility="{Binding DataContext.SelectedReconciliation, Converter={StaticResource ValueExistsToVisibilityConverter}, RelativeSource={RelativeSource AncestorType={x:Type Reconciliation:CtlReconciliationList}}}">
                            <!-- common part -->
                            <StackPanel>
                                <ListBox ItemsSource="{Binding Warnings}" BorderBrush="Transparent" BorderThickness="0" IsTabStop="False" Background="Transparent" ScrollViewer.VerticalScrollBarVisibility="Disabled">
                                    <ListBox.Resources>
                                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent"/>
                                    </ListBox.Resources>
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="ContentTemplate">
                                                <Setter.Value>
                                                    <DataTemplate>
                                                        <my:CtlErrorMessage Margin="0,2,0,0" Message="{Binding .}" />
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>

                                <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.NameCaption}" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding Name, UpdateSourceTrigger=LostFocus}" IsEnabled="False"/>
                                    <wpfc:TogglePopup Grid.Column="1" ImageSource="/eBalanceKitResources;component/Resources/Info.png" Margin="5,0,0,0" ImageHeight="14" VerticalAlignment="Center" >
                                        <Border Style="{StaticResource PopupBorder}" Width="250" >
                                            <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.NameInfo}" TextWrapping="Wrap" />
                                        </Border>
                                    </wpfc:TogglePopup>
                                </Grid>
                                <!--<Expander Header="{x:Static Localisation:ResourcesReconciliation.CommentCaption}" Margin="0,5,0,0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <TextBox Text="{Binding Comment, UpdateSourceTrigger=LostFocus}" TextWrapping="Wrap" MaxHeight="100"
                                             HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" AcceptsReturn="True"
                                             IsEnabled="{Binding IsEditable}"/>

                                        <wpfc:TogglePopup Grid.Column="1" ImageSource="/eBalanceKitResources;component/Resources/Info.png" Margin="5,0,0,0" ImageHeight="14" >
                                            <Border Style="{StaticResource PopupBorder}" Width="250" VerticalAlignment="Center" >
                                                <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.CommentInfo}" TextWrapping="Wrap" />
                                            </Border>
                                        </wpfc:TogglePopup>
                                    </Grid>
                                </Expander>-->
                            </StackPanel>

                            <!-- Reclassification details -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="DataContext" Value="{x:Null}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>Reclassification</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.PositionsCaption}" Margin="0,5,0,0" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}" />
                                <StackPanel AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}">
                                    <Border Style="{StaticResource GroupBoxBorder}">
                                        <StackPanel Margin="10,3,1,1">
                                            <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.ReconciliationReclassificationSource}" Margin="0,5,0,0" />
                                            <DragDropHelperItems:ReclassificationSource Margin="0,0,0,0" />

                                            <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.ReconciliationReclassificationDest}" Margin="0,5,0,0" />
                                            <DragDropHelperItems:ReclassificationDest Margin="0,0,0,0" />
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                                <Border Name="ReclassificationSourceHelper" Style="{StaticResource GroupBoxBorder}" Margin="0,15,0,0" AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop">
                                    <StackPanel Margin="10,25,10,25" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.DragSourceItemHereCaption}" IsHitTestVisible="False" Foreground="Gray" FontStyle="Italic" FontSize="11"/>
                                    </StackPanel>
                                </Border>
                                <Border Name="ReclassificationDestinationHelper" Style="{StaticResource GroupBoxBorder}" Margin="0,15,0,0" AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop">
                                    <StackPanel Margin="10,25,10,25" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.DragDestinationItemHereCaption}" IsHitTestVisible="False" Foreground="Gray" FontStyle="Italic" FontSize="11"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- ValueChange details -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="DataContext" Value="{x:Null}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>ValueChange</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.PositionsCaption}" Margin="0,5,0,0" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}" />
                                <StackPanel AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}">
                                    <Border Style="{StaticResource GroupBoxBorder}">
                                        <StackPanel>
                                            <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.EmptyCustomReconciliationNote}" TextWrapping="Wrap" Margin="5" FontStyle="Italic"
                                               Foreground="#666" Visibility="{Binding HasTransaction, Converter={StaticResource FalseToVisibilityConverter}}"/>
                                            <wpfc:AvdTreeView ItemsSource="{Binding TransactionGroups}" ItemTemplateSelector="{StaticResource DeltaReconciliationDetailTemplateSelector}"
                                                  Background="Transparent" BorderBrush="Transparent" BorderThickness="0" PreviewMouseWheel="HandlePreviewMouseWheel"
                                                  ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                                <wpfc:AvdTreeView.Resources>
                                                    <Style TargetType="{x:Type TreeViewItem}">
                                                        <Setter Property="Background" Value="Transparent"/>
                                                        <Setter Property="Padding" Value="0"/>
                                                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                                        <Setter Property="Visibility" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsVisible, Mode=OneWay, Converter={StaticResource TrueToVisibilityConverter}}"/>
                                                        <Setter Property="IsSelected" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                        <Setter Property="IsExpanded" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                        <Setter Property="Template" Value="{StaticResource ExpandedTreeViewItem}" />
                                                    </Style>
                                                </wpfc:AvdTreeView.Resources>
                                            </wpfc:AvdTreeView>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                                <Border Style="{StaticResource GroupBoxBorder}" Margin="0,15,0,0" AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop">
                                    <StackPanel Margin="10,25,10,25" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock TextWrapping="Wrap" Text="{x:Static Localisation:ResourcesReconciliation.DragItemsHereCaption}" IsHitTestVisible="False" Foreground="Gray" FontStyle="Italic" FontSize="11"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Delta reconciliation details -->
                            <!-- AuditCorrection reconciliation details -->
                            <!-- AuditCorrectionPreviousYear reconciliation details -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="DataContext" Value="{x:Null}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>Delta</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>

                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>AuditCorrection</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>

                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>AuditCorrectionPreviousYear</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <!--<TextBlock Text="{x:Static Localisation:ResourcesReconciliation.ReconciliationKindCaption}" Margin="0,5,0,0" />
                                <ComboBox ItemsSource="{Binding TransferKinds}" SelectedItem="{Binding TransferKind}" IsEnabled="{Binding Document.ReportRights.WriteTransferValuesAllowed}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource TransferKindToLabelConverter}}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>-->
                                <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.PositionsCaption}" Margin="0,5,0,0" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}" />
                                <StackPanel AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}">
                                    <Border Style="{StaticResource GroupBoxBorder}">
                                        <StackPanel>
                                            <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.EmptyCustomReconciliationNote}" TextWrapping="Wrap" Margin="5" FontStyle="Italic"
                                               Foreground="#666" Visibility="{Binding HasTransaction, Converter={StaticResource FalseToVisibilityConverter}}"/>
                                            <wpfc:AvdTreeView ItemsSource="{Binding TransactionGroups}" ItemTemplateSelector="{StaticResource DeltaReconciliationDetailTemplateSelector}"
                                                  Background="Transparent" BorderBrush="Transparent" BorderThickness="0" PreviewMouseWheel="HandlePreviewMouseWheel"
                                                  ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                                <wpfc:AvdTreeView.Resources>
                                                    <Style TargetType="{x:Type TreeViewItem}">
                                                        <Setter Property="Background" Value="Transparent"/>
                                                        <Setter Property="Padding" Value="0"/>
                                                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                                        <Setter Property="Visibility" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsVisible, Mode=OneWay, Converter={StaticResource TrueToVisibilityConverter}}"/>
                                                        <Setter Property="IsSelected" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                        <Setter Property="IsExpanded" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                        <Setter Property="Template" Value="{StaticResource ExpandedTreeViewItem}" />
                                                    </Style>
                                                </wpfc:AvdTreeView.Resources>
                                            </wpfc:AvdTreeView>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                                <Border Style="{StaticResource GroupBoxBorder}" Margin="0,15,0,0" AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop">
                                    <StackPanel Margin="10,25,10,25" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock TextWrapping="Wrap" Text="{x:Static Localisation:ResourcesReconciliation.DragItemsHereCaption}" IsHitTestVisible="False" Foreground="Gray" FontStyle="Italic" FontSize="11"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- ImportedValues details -->
                            <StackPanel AllowDrop="True">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="DataContext" Value="{x:Null}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>ImportedValues</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.PositionsCaption}" Margin="0,5,0,0" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}" />
                                <Border Style="{StaticResource GroupBoxBorder}" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.EmptyImportedReconciliationNote}" TextWrapping="Wrap" Margin="5" FontStyle="Italic"
                                           Foreground="#666" Visibility="{Binding HasTransaction, Converter={StaticResource FalseToVisibilityConverter}}"/>
                                        <wpfc:AvdTreeView ItemsSource="{Binding TransactionGroups}" ItemTemplateSelector="{StaticResource ImportedValuesDetailTemplateSelector}"
                                          Background="Transparent" BorderBrush="Transparent" BorderThickness="0" PreviewMouseWheel="HandlePreviewMouseWheel"
                                          ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                            <wpfc:AvdTreeView.Resources>
                                                <Style TargetType="{x:Type TreeViewItem}">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="Padding" Value="0"/>
                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                                    <Setter Property="Visibility" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsVisible, Mode=OneWay, Converter={StaticResource TrueToVisibilityConverter}}"/>
                                                    <Setter Property="IsSelected" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                    <Setter Property="IsExpanded" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                    <Setter Property="Template" Value="{StaticResource ExpandedTreeViewItem}" />
                                                </Style>
                                            </wpfc:AvdTreeView.Resources>
                                        </wpfc:AvdTreeView>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- PreviousYearValues details -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="DataContext" Value="{x:Null}" />
                                        <Style.Triggers>
                                            <!--<DataTrigger Binding="{Binding ReconciliationType}">-->
                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>PreviousYearValues</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <!--<Setter Property="DataContext" Value="{Binding DataContext}" />-->
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock TextWrapping="Wrap" Text="{x:Static Localisation:ResourcesReconciliation.PositionsCaption}" Margin="0,5,0,0" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}" />
                                <Border Style="{StaticResource GroupBoxBorder}" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.EmptyImportedReconciliationNote}" TextWrapping="Wrap" Margin="5" FontStyle="Italic"
                                           Foreground="#666" Visibility="{Binding HasTransaction, Converter={StaticResource FalseToVisibilityConverter}}"/>
                                        <wpfc:AvdTreeView ItemsSource="{Binding TransactionGroups}" ItemTemplateSelector="{StaticResource ImportedValuesDetailTemplateSelector}"
                                          Background="Transparent" BorderBrush="Transparent" BorderThickness="0" PreviewMouseWheel="HandlePreviewMouseWheel"
                                          ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                            <wpfc:AvdTreeView.Resources>
                                                <Style TargetType="{x:Type TreeViewItem}">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="Padding" Value="0"/>
                                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                                    <Setter Property="Visibility" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsVisible, Mode=OneWay, Converter={StaticResource TrueToVisibilityConverter}}"/>
                                                    <Setter Property="IsSelected" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                    <Setter Property="IsExpanded" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                    <Setter Property="Template" Value="{StaticResource ExpandedTreeViewItem}" />
                                                </Style>
                                            </wpfc:AvdTreeView.Resources>
                                        </wpfc:AvdTreeView>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- TaxBalanceValue details -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="DataContext" Value="{x:Null}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.ReconciliationType, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}">
                                                <DataTrigger.Value>
                                                    <Enums:ReconciliationTypes>TaxBalanceValue</Enums:ReconciliationTypes>
                                                </DataTrigger.Value>
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Setter Property="DataContext" Value="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Reconciliation:CtlReconciliationDetailsView}}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.PositionsCaption}" Margin="0,5,0,0" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}"/>
                                <StackPanel AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop" Visibility="{Binding HasTransaction, Converter={StaticResource TrueToVisibilityConverter}}">
                                    <Border Style="{StaticResource GroupBoxBorder}">
                                        <StackPanel>
                                            <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.EmptyCustomReconciliationNote}" TextWrapping="Wrap" Margin="5" FontStyle="Italic"
                                               Foreground="#666" Visibility="{Binding HasTransaction, Converter={StaticResource FalseToVisibilityConverter}}"/>
                                            <wpfc:AvdTreeView ItemsSource="{Binding TransactionGroups}" ItemTemplateSelector="{StaticResource DeltaReconciliationDetailTemplateSelector}"
                                                  Background="Transparent" BorderBrush="Transparent" BorderThickness="0" PreviewMouseWheel="HandlePreviewMouseWheel"
                                                  ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                                <wpfc:AvdTreeView.Resources>
                                                    <Style TargetType="{x:Type TreeViewItem}">
                                                        <Setter Property="Background" Value="Transparent"/>
                                                        <Setter Property="Padding" Value="0"/>
                                                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                                        <Setter Property="Visibility" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsVisible, Mode=OneWay, Converter={StaticResource TrueToVisibilityConverter}}"/>
                                                        <Setter Property="IsSelected" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                        <Setter Property="IsExpanded" Value="{Binding RelativeSource={RelativeSource Self}, Path=Header.IsExpanded, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                        <Setter Property="Template" Value="{StaticResource ExpandedTreeViewItem}" />
                                                    </Style>
                                                </wpfc:AvdTreeView.Resources>
                                            </wpfc:AvdTreeView>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                                <Border Style="{StaticResource GroupBoxBorder}" Margin="0,15,0,0" AllowDrop="True" DragOver="ControlDragOver" Drop="ControlDrop">
                                    <StackPanel Margin="10,25,10,25" VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock TextWrapping="Wrap" Text="{x:Static Localisation:ResourcesReconciliation.DragItemsHereCaption}" IsHitTestVisible="False" Foreground="Gray" FontStyle="Italic" FontSize="11"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                            
                        </StackPanel>
                    </ScrollViewer>

                    <TextBlock Text="{x:Static Localisation:ResourcesReconciliation.NoItemSelectedNote}" TextWrapping="Wrap" Margin="5" FontStyle="Italic"
                           HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#666" >
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Visibility, ElementName=stackPanel}" Value="Visible">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                    </TextBlock>
                </Grid>
            </Border>
            </Grid>
            <Border Grid.Row="3" Style="{StaticResource ButtonBorder}">
                <!--placeholder-->
                <TextBlock Text=" " Margin="5,2" />
            </Border>
        </Grid>
</UserControl>
